{% extends 'layout.html' %}

{% block head %}

    <link rel="stylesheet" href="{{ url_for('static', filename = 'directory.css') }}">

{% endblock head %}


{% block content %}

    <div class = "flexh">
        <div class = "directory flexv">
            <script>
            document.onload(showAllDaycares());
            </script>
            <!--This is where the daycares are displayed-->
            <div id="daycareSpot">
            </div>
            <!-- might need this code for later-->
            <!--{% for daycare in database %}
                <div class = "daycare-box red">
                    <h4>{{ daycare["facility_name"] }}</h4>
                    
                    

                </div>
            {% endfor %}*/-->
            <!-- This is where all of the filtering select boxes are
            This hasn't been structured to look good yet. The trick with this
            is that the values of each option are identical to the specific
            option within the database-->
            <!--TO DO:
            THIS LOOKS LIKE ASS AND TURNS OUT YOU CAN SORT EVERYTHING ALPHABETICALLY
            EXCEPT FOR SELECT BOX DROP DOWN MENUS. SO NEED TO FIGURE OUT A WAY HOW TO
            SORT THESE OPTIONS ALPHABETICALLY WITHIN THIS DOCUMENT ITSELF.-->
        </div>
        <div class = "filter">
            <h3>FILTERS</h3>
            <p id="testing"> </p>
            <p id="testing2"> </p>
            <p id="testing3"> </p>
            <div>
                <select id="county">
                    <option value="noSelection"> Any County </option>
                    <option value="Antigonish County"> Antigonish </option>
                    <option value="Halifax County"> Halifax </option>
                    <option value="Cumberland County"> Cumberland </option>
                    <option value="Kings County"> Kings </option>
                    <option value="Cape Breton County"> Cape Breton </option>
                    <option value="Colchester County"> Colchester </option>
                    <option value="Richmond County"> Richmond </option>
                    <option value="Shelburne County"> Shelburne </option>
                    <option value="Annapolis County"> Annapolis </option>
                    <option value="Yarmouth County"> Yarmouth </option>
                    <option value="Queens County"> Queens </option>
                    <option value="Inverness County"> Inverness </option>
                    <option value="Pictou County"> Pictou </option>
                    <option value="Lunenburg County"> Lunenburg </option>
                    <option value="Hants County"> Hants </option>
                    <option value="Digby County"> Digby </option>
                </select>
            </div>

            <div>
                <select id="daycare_type">
                    <option value="noSelection"> Any Type </option>
                    <option value="FamilyHome"> Family Home </option>
                    <option value="DayCare"> Day Care </option>
                </select>
            </div>

            <div>
                <select id="city">
                    <option value="noSelection"> Any City </option>
                    <option value="Westville"> Westville </option>
                    <option value="Cfb Greenwood"> Cfb Greenwood </option>
                    <option value="Antigonish"> Antigonish </option>
                    <option value="Barrington Passage"> Barrington Passage </option>
                    <option value="Hammonds Plains"> Hammonds Plains </option>
                    <option value="Debert"> Debert </option>
                    <option value="Port Hawkesbury"> Port Hawkesbury </option>
                    <option value="Bridgewater"> Bridgewater </option>
                    <option value="Parrsboro"> Parrsboro </option>
                    <option value="Truro"> Truro </option>
                    <option value="Cole Harbour"> Cole Harbour </option>
                    <option value="Clark's Harbour"> Clark's Harbour </option>
                    <option value="Enfield"> Enfield </option>
                    <option value="Yarmouth"> Yarmouth </option>
                    <option value="Lawrencetown"> Lawrencetown </option>
                    <option value="Dartmouth"> Dartmouth </option>
                    <option value="Shubenacadie"> Shubenacadie </option>
                    <option value="St. Peter's"> St. Peter's </option>
                    <option value="Salmon River"> Salmon River </option>
                    <option value="Milton Highlands"> Milton Highlands </option>
                    <option value="Hatchet Lake"> Hatchet Lake </option>
                    <option value="Lockeport"> Lockeport </option>
                    <option value="Dutch Settlement"> Dutch Settlement </option>
                    <option value="Chester"> Chester </option>
                    <option value="Oxford"> Oxford </option>
                    <option value="Brookdale"> Brookdale </option>
                    <option value="Halifax"> Halifax </option>
                    <option value="Shearwater"> Shearwater </option>
                    <option value="Stoney Island"> Stoney Island </option>
                    <option value="Mount Pleasant"> Mount Pleasant </option>
                    <option value="Lunenburg"> Lunenburg </option>
                    <option value="Westmount"> Westmount </option>
                    <option value="Tatamagouche"> Tatamagouche </option>
                    <option value="Prospect Bay"> Prospect Bay </option>
                    <option value="Chéticamp"> Chéticamp </option>
                    <option value="Bedford"> Bedford </option>
                    <option value="Pictou"> Pictou </option>
                    <option value="Upper Tantallon"> Upper Tantallon </option>
                    <option value="Hubley"> Hubley </option>
                    <option value="Whycocomagh"> Whycocomagh </option>
                    <option value="Valley"> Valley </option>
                    <option value="North Preston"> North Preston </option>
                    <option value="Lower South River"> Lower South River </option>
                    <option value="Canning"> Canning </option>
                    <option value="Cambridge"> Cambridge </option>
                    <option value="Berwick"> Berwick </option>
                    <option value="Trenton"> Trenton </option>
                    <option value="Arichat"> Arichat </option>
                    <option value="New Ross"> New Ross </option>
                    <option value="Brookfield"> Brookfield </option>
                    <option value="Middle Sackville"> Middle Sackville </option>
                    <option value="Kentville"> Kentville </option>
                    <option value="Bible Hill"> Bible Hill </option>
                    <option value="Brooklyn"> Brooklyn </option>
                    <option value="Mira Road"> Mira Road </option>
                    <option value="Caledonia"> Caledonia </option>
                    <option value="Porters Lake"> Porters Lake </option>
                    <option value="Gaspereau"> Gaspereau </option>
                    <option value="Wilmot"> Wilmot </option>
                    <option value="Windsor"> Windsor </option>
                    <option value="East Preston"> East Preston </option>
                    <option value="Waverley"> Waverley </option>
                    <option value="Port Williams"> Port Williams </option>
                    <option value="Digby"> Digby </option>
                    <option value="Stellarton"> Stellarton </option>
                    <option value="Shelburne"> Shelburne </option>
                    <option value="Beaver Bank"> Beaver Bank </option>
                    <option value="Masstown"> Masstown </option>
                    <option value="Little Bras D'or"> Little Bras D'or </option>
                    <option value="Sydney Mines"> Sydney Mines </option>
                    <option value="Lantz"> Lantz </option>
                    <option value="Wolfville Ridge"> Wolfville Ridge </option>
                    <option value="Hubbards"> Hubbards </option>
                    <option value="Middleton"> Middleton </option>
                    <option value="Lake Echo"> Lake Echo </option>
                    <option value="Greenwood"> Greenwood </option>
                    <option value="Meteghan"> Meteghan </option>
                    <option value="Grand Lake Road"> Grand Lake Road </option>
                    <option value="New Glasgow"> New Glasgow </option>
                    <option value="West Pubnico"> West Pubnico </option>
                    <option value="Auburn"> Auburn </option>
                    <option value="West Gore"> West Gore </option>
                    <option value="Timberlea"> Timberlea </option>
                    <option value="Liverpool"> Liverpool </option>
                    <option value="Osborne Harbour"> Osborne Harbour </option>
                    <option value="Stewiacke"> Stewiacke </option>
                    <option value="Middle Musquodoboit"> Middle Musquodoboit </option>
                    <option value="Springhill"> Springhill </option>
                    <option value="Lower Sackville"> Lower Sackville </option>
                    <option value="Eastern Passage"> Eastern Passage </option>
                    <option value="Coxheath"> Coxheath </option>
                    <option value="Cookville"> Cookville </option>
                    <option value="Coldbrook"> Coldbrook </option>
                    <option value="Sydney River"> Sydney River </option>
                    <option value="Meteghan Centre"> Meteghan Centre </option>
                    <option value="Post Road"> Post Road </option>
                    <option value="New Waterford"> New Waterford </option>
                    <option value="Beechville"> Beechville </option>
                    <option value="Howie Centre"> Howie Centre </option>
                    <option value="Tusket"> Tusket </option>
                </select>
            </div>

            <div>
                <select id="age1">
                    <option value="noSelection"> Any Age Group </option>
                    <option value="age_infant"> Infant </option>
                    <option value="age_toddler"> Toddler </option>
                    <option value="age_preschool"> Preschool </option>
                    <option value="age_school_age"> School </option>
                </select>
            </div>

            <div>
                <select id="age2">
                    <option value="noSelection"> Any Age Group </option>
                    <option value="age_infant"> Infant </option>
                    <option value="age_toddler"> Toddler </option>
                    <option value="age_preschool"> Preschool </option>
                    <option value="age_school_age"> School </option>
                </select>
            </div>

            <div>
                <select id="capacity">
                    <option value="noSelection"> Any Size Capacity </option>
                    <option value="20"> 20 and Under </option>
                    <option value="40"> 21 to 40 </option>
                    <option value="60"> 41 to 60 </option>
                    <option value="80"> 61 to 80 </option>
                    <option value="100"> 81 to 100 </option>
                    <option value="101"> 101 and Above </option>
                </select>
            </div>


            <div>
            <input type="checkbox" id="annualInspection" checked> Annual Inspection Recorded </input>
            </div>

            <div>
            <input type="checkbox" id="unannouncedInspection" checked> Unannounced Annual Inspection Recorded </input>
            </div>



            <div>
                <button onclick="databaseFilter()"> Submit </button>
            </div>
        </div>
        </div>
        <!-- This is where most of the functionality of filtering
        resides. It looks kind of confusing at times but it's just a whole
        lot of comparing between arrays and the database. -->
        <script type="text/javascript">
        // Set up the variables that all functions need to use
        var filteredDaycareArray = [];
        var daycaresToDelete = [];
        var uncommonValues = [];
        var database;


        // This function is finding the difference between the current databases
        // and the databases that need to be deleted. This function is called
        // at the end of each of the filterings. 
        // (The difference being all entries that are in filteredDaycareArray and
        // are not in daycaresToDelete)
        // This function returns a new array of the correct daycares filtered.
        function updateDaycares(){
            uncommonValues = [];
            uncommonValues = filteredDaycareArray.filter(x => !daycaresToDelete.includes(x))
            //daycaresToDelete = [];
            return uncommonValues;
        }

        // This function is just displaying all filtered daycares with html
        // This needs to be turned into clickable links that bring you to the specific
        // daycares webpage.
        function showDaycares()
        {
            var display;
            for (i=0 ; i<filteredDaycareArray.length ; i++)
            {
                display = display + "<div class = 'daycare-box c1 raw'><h4 class = 'raw'>"+ database[filteredDaycareArray[i]].facility_name+"</h4>";
                display = display + "<h6 class = 'raw'>Index:"+ database[filteredDaycareArray[i]].index+"</h6></div>"
            }
            if (filteredDaycareArray.length==0)
            {
                display = "<div><h4> There are no Daycares that match your selection <div><h4>";
            }
            document.getElementById("daycareSpot").innerHTML = display;
        }

        function showAllDaycares()
        {
            database = {{ database | tojson }};

            for (i = 0; i<database.length;i++)
            {
                filteredDaycareArray.push(i);
            }

            var display;
            for (i=0 ; i<filteredDaycareArray.length ; i++)
            {
                display = display + "<div class = 'daycare-box c1 raw'><h4 class = 'raw'>"+ database[filteredDaycareArray[i]].facility_name+"</h4>";
                display = display + "<h6 class = 'raw'>Index:"+ database[filteredDaycareArray[i]].index+"</h6></div>"
            }
            if (filteredDaycareArray.length==0)
            {
                display = "<div><h4> There are no Daycares that match your selection <div><h4>";
            }
            document.getElementById("daycareSpot").innerHTML = display;
        }

        // This function is where the filtering happens. It will also call
        // the above functions. This function is triggered when the submit
        // button is pressed and will reset each time it is pressed. 
        // This function has a lot of the same thing going on, so I'll just
        // explain the first couple and hopefully the rest make sense.
        function databaseFilter()
        {
            // reset the variables for each filtering
            filteredDaycareArray = [];
            daycaresToDelete = [];
            //database = {{ database | tojson }};

            /*for (i = 0; i<database.length;i++)
            {
                filteredDaycareArray.push(i);
            }*/

            var elementCounty = document.getElementById("county");
            var selectedCounty = elementCounty.options[elementCounty.selectedIndex].value;

            // if a county has not been selected and is still on
            // the "Choose a county" selection
            if ((selectedCounty.localeCompare("noSelection")!=0)) 
            {
                // for each daycare in the database
                for (i = 0; i < filteredDaycareArray.length; i++)
                {
                    //check to see if the daycare even has a county
                    if ('county' in database[filteredDaycareArray[i]])
                    {
                        //compare each daycare in the databases county to
                        // the selected county
                        if ((selectedCounty.localeCompare(database[i].county)!=0))
                        {
                            // if they have the same county, add the .index
                            // of that daycare to the filtered daycare array
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                        
                }
                filteredDaycareArray = updateDaycares();
            }
            

            var elementType = document.getElementById("daycare_type");
            var selectedType = elementType.options[elementType.selectedIndex].value;

            // check to see that the type of facility has been selected
            if ((selectedType.localeCompare("noSelection")!=0))
            {   // go through all of the FILTERED daycares indexs
                for (i = 0; i < filteredDaycareArray.length ; i++)
                {
                    // make sure family_home is even in that daycare
                    if ('family_home' in database[filteredDaycareArray[i]])
                    {
                        // this is confusing, but it's just comparing like before
                        if (selectedType.localeCompare("DayCare")==0)
                        {
                            var yes = "Yes";
                            if(yes.localeCompare(database[filteredDaycareArray[i]].family_home)==0)
                            {
                                // this selected daycare does not line up with the filtering,
                                // so add it to the list of daycares to be deleted
                                daycaresToDelete.push(filteredDaycareArray[i]);
                            }
                        } else
                        {
                            var no = "No";
                            if(no.localeCompare(database[filteredDaycareArray[i]].family_home)==0)
                            {
                                // same here as above
                                daycaresToDelete.push(filteredDaycareArray[i]);
                            }
                        }
                    }
                }
                // now, update the filteredArray so that it deletes all
                // entrys that are in the daycaresToDelete array
                filteredDaycareArray = updateDaycares();
            }

            var elementCity = document.getElementById("city");
            var selectedCity = elementCity.options[elementCity.selectedIndex].value;

            window.alert(filteredDaycareArray);

            if (selectedCity.localeCompare("noSelection")!=0)
            {
                for (i = 0; i < filteredDaycareArray.length ; i++)
                {
                    if ('city' in database[filteredDaycareArray[i]])
                    {
                        if((selectedCity.localeCompare(database[filteredDaycareArray[i]].city)!=0))
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    
                    }
                }
                filteredDaycareArray = updateDaycares();
            }


            var elementAnalInspection = document.getElementById("annualInspection");
            if (elementAnalInspection.checked)
            {
                for (i = 0; i < filteredDaycareArray.length ; i++)
                {
                    if('annual_inspection' in database[filteredDaycareArray[i]])
                    {
                        // do nothing
                    }
                    else
                    {
                        daycaresToDelete.push(filteredDaycareArray[i]);
                    }
                }
                filteredDaycareArray = updateDaycares();
            }
            else
            {
                for (i = 0; i < filteredDaycareArray.length ; i++)
                {
                    if('annual_inspection' in database[filteredDaycareArray[i]])
                    {
                        daycaresToDelete.push(filteredDaycareArray[i]);
                    }
                }
                filteredDaycareArray = updateDaycares();
            }


            var elementUnaInspection = document.getElementById("unannouncedInspection");
            if (elementUnaInspection.checked)
            {
                for (i = 0; i < filteredDaycareArray.length ; i++)
                {
                    if('annual_unannounced_inspection' in database[filteredDaycareArray[i]])
                    {
                        // do nothing
                    }
                    else
                    {
                        daycaresToDelete.push(filteredDaycareArray[i]);
                    }
                }
                filteredDaycareArray = updateDaycares();
            }
            else
            {
                for (i = 0; i < filteredDaycareArray.length ; i++)
                {
                    if('annual_unannounced_inspection' in database[filteredDaycareArray[i]])
                    {
                        daycaresToDelete.push(filteredDaycareArray[i]);
                    }
                }
                filteredDaycareArray = updateDaycares();
            }

            var elementAge = document.getElementById("age1");
            var selectedAge = elementAge.options[elementAge.selectedIndex].value;
            var no = "No";
            if ((selectedAge.localeCompare("noSelection")!=0))
            {
                for (i=0 ; i<filteredDaycareArray.length ; i++)
                {
                    if (selectedAge.localeCompare("age_infant"))
                    {
                        if(no.localeCompare(database[filteredDaycareArray[i]].age_infant)==0)
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                    if (selectedAge.localeCompare("age_toddler"))
                    {
                        if(no.localeCompare(database[filteredDaycareArray[i]].age_toddler)==0)
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                    if(selectedAge.localeCompare("age_preschool"))
                    {
                        if(no.localeCompare(database[filteredDaycareArray[i]].age_preschool)==0)
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                    if(selectedAge.localeCompare("age_school_age"))
                    {
                        if(no.localeCompare(database[filteredDaycareArray[i]].age_school_age)==0)
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                }
                filteredDaycareArray = updateDaycares();
            }

            var elementAge2 = document.getElementById("age2");
            var selectedAge2 = elementAge2.options[elementAge2.selectedIndex].value;
            var no = "No";
            if ((selectedAge2.localeCompare("noSelection")!=0))
            {
                for (i=0 ; i<filteredDaycareArray.length ; i++)
                {
                    if (selectedAge2.localeCompare("age_infant"))
                    {
                        if(no.localeCompare(database[filteredDaycareArray[i]].age_infant)==0)
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                    if (selectedAge2.localeCompare("age_toddler"))
                    {
                        if(no.localeCompare(database[filteredDaycareArray[i]].age_toddler)==0)
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                    if(selectedAge2.localeCompare("age_preschool"))
                    {
                        if(no.localeCompare(database[filteredDaycareArray[i]].age_preschool)==0)
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                    if(selectedAge2.localeCompare("age_school_age"))
                    {
                        if(no.localeCompare(database[filteredDaycareArray[i]].age_school_age)==0)
                        {
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                }
                filteredDaycareArray = updateDaycares();
            }
        

            var elementCapacity = document.getElementById("capacity");
            var selectedCapacity = elementCapacity.options[elementCapacity.selectedIndex].value;
            var currentDaycareCapacity;
            if(selectedCapacity.localeCompare("noSelection")!=0)
            {
                for (i=0 ; i<filteredDaycareArray.length ; i++)
                {
                    if('total_licance_capacity' in database[filteredDaycareArray[i]])
                    {
                        currentDaycareCapacity = parseInt(database[filteredDaycareArray[i]].total_licance_capacity);
                        if(selectedCapacity.localeCompare("20")==0)
                        {
                            if(currentDaycareCapacity>20)
                            {
                                daycaresToDelete.push(filteredDaycareArray[i]);
                            }
                        }
                        if(selectedCapacity.localeCompare("40")==0)
                        {
                            if(currentDaycareCapacity<21 || currentDaycareCapacity>41)
                            {
                                daycaresToDelete.push(filteredDaycareArray[i]);
                            }
                        }
                        if(selectedCapacity.localeCompare("60")==0)
                        {
                            if(currentDaycareCapacity<41 || currentDaycareCapacity>61)
                            {
                                daycaresToDelete.push(filteredDaycareArray[i]);
                            }
                        }
                        if(selectedCapacity.localeCompare("80")==0)
                        {
                            if(currentDaycareCapacity<61 || currentDaycareCapacity>81)
                            {
                                daycaresToDelete.push(filteredDaycareArray[i]);
                            }
                        }
                        if(selectedCapacity.localeCompare("100")==0)
                        {
                            if(currentDaycareCapacity<81 || currentDaycareCapacity>101)
                            {
                                daycaresToDelete.push(filteredDaycareArray[i]);
                            }
                        }
                        if(selectedCapacity.localeCompare("101")==0)
                        {
                            if(currentDaycareCapacity<101)
                            {
                                daycaresToDelete.push(filteredDaycareArray[i]);
                            }
                        }
                    }
                    else
                    {
                        daycaresToDelete.push(filteredDaycareArray[i]);
                    }
                    
                }
                filteredDaycareArray = updateDaycares();
            }

            // this is all for testing purposes
            //document.getElementById("testing").innerHTML = currentDaycares;
            var object = document.getElementById("county");
            var value = object.options[object.selectedIndex].value;
            document.getElementById("testing").innerHTML = filteredDaycareArray;
            document.getElementById("testing2").innerHTML = daycaresToDelete;
            document.getElementById("testing3").innerHTML = uncommonValues;
            showDaycares();
            //window.alert(database);
            //window.alert(daycare["age_range"]);
            //if(daycare["age_range"] = "5 years - 12 years"){
            //    window.alert("One found");
            //}
            
            
        }
        document.onload(showAllDaycares());
        </script>
    </div>

{% endblock content %}