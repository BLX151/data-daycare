{% extends 'layout.html' %}

{% block head %}

    <link rel="stylesheet" href="{{ url_for('static', filename = 'directory.css') }}">

{% endblock head %}


{% block content %}

    <div class = "flexh">
        <div class = "directory flexv">
            <div class = "daycare-box red">
            <!--This is where the daycares are displayed-->
            <div id="daycareSpot"></div>
            </div>

            <!-- might need this code for later-->
            <!--{% for daycare in database %}
                <div class = "daycare-box red">
                    <h4>{{ daycare["facility_name"] }}</h4>
                    
                    

                </div>
            {% endfor %}*/-->
            
            
        </div>
        <!-- This is where all of the filtering select boxes are
        This hasn't been structured to look good yet. The trick with this
        is that the values of each option are identical to the specific
        option within the database-->
        <div class = "filter">
            <h3>FILTERS</h3>
            <p id="testing"> </p>
            <p id="testing2"> </p>
            <p id="testing3"> </p>
            <div>
                <select id="county">
                    <option value="noSelection"> Select a County </option>
                    <option value="Antigonish County"> Antigonish </option>
                    <option value="Halifax County"> Halifax </option>
                    <option value="Cumberland County"> Cumberland </option>
                    <option value="Kings County"> Kings </option>
                    <option value="Cape Breton County"> Cape Breton </option>
                    <option value="Colchester County"> Colchester </option>
                    <option value="Richmond County"> Richmond </option>
                    <option value="Shelburne County"> Shelburne </option>
                    <option value="Annapolis County"> Annapolis </option>
                    <option value="Yarmouth County"> Yarmouth </option>
                    <option value="Queens County"> Queens </option>
                    <option value="Inverness County"> Inverness </option>
                    <option value="Pictou County"> Pictou </option>
                    <option value="Lunenburg County"> Lunenburg </option>
                    <option value="Hants County"> Hants </option>
                    <option value="Digby County"> Digby </option>
                </select>
            </div>
            <div>
                <select id="daycare_type">
                    <option value="noSelection"> Select a Type </option>
                    <option value="FamilyHome"> Family Home </option>
                    <option value="DayCare"> Day Care </option>
                </select>
            </div>

            <div>
            <input type="checkbox" id="annualInspection" checked> Annual Inspection Recorded </input>
            </div>

            <div>
            <input type="checkbox" id="unannouncedInspection" checked> Unannounced Annual Inspection Recorded </input>
            </div>

            <div>
                <button onclick="databaseFilter()"> Submit </button>
            </div>
            <!--<iframe name="hidden_iframe" width="0" height="0" style="border:none"></iframe>
            <form method="post" action="out.txt" target="hidden_iframe">
			
	        <input type="submit" name="foo" value="A" />
			<input type="submit" name="foo" value="B" />
			<input type="submit" name="foo" value="C" />
			<input type="submit" name="foo" value="D" />
			<input type="submit" name="foo" value="E" />
			<input type="submit" name="foo" value="F" />
			<input type="submit" name="foo" value="G" />
		
		    </form>-->
            
        </div>

    </div>

    <!-- This is where most of the functionality of filtering
    resides. It looks kind of confusing at times but it's just a whole
    lot of comparing between arrays and the database. -->
    <script type="text/javascript">
    // Set up the variables that all functions need to use
    var filteredDaycareArray = [];
    var daycaresToDelete = [];
    var uncommonValues = [];
    var database;

    // This function is finding the difference between the current databases
    // and the databases that need to be deleted. This function is called
    // at the end of each of the filterings. 
    // (The difference being all entries that are in filteredDaycareArray and
    // are not in daycaresToDelete)
    // This function returns a new array of the correct daycares filtered.
    function updateDaycares(){
        uncommonValues = [];
        uncommonValues = filteredDaycareArray.filter(x => !daycaresToDelete.includes(x))
        return uncommonValues;
    }

    // This function is just displaying all filtered daycares with html
    // This needs to be turned into clickable links that bring you to the specific
    // daycares webpage.
    function showDaycares(){
        var display;
        for (i=0 ; i<filteredDaycareArray.length ; i++)
        {
            display = display + "<div><h4>"+ database[filteredDaycareArray[i]].facility_name+"</h4></div><br>";
        }
        if (filteredDaycareArray.length==0)
        {
            display = "<div><h4> There are no Daycares that match your selection <div><h4>";
        }
        document.getElementById("daycareSpot").innerHTML = display;
    }

    // This function is where the filtering happens. It will also call
    // the above functions. This function is triggered when the submit
    // button is pressed and will reset each time it is pressed. 
    // This function has a lot of the same thing going on, so I'll just
    // explain the first couple and hopefully the rest make sense.
    function databaseFilter(){
        // reset the variables for each filtering
        filteredDaycareArray = [];
        daycaresToDelete = [];
        database = {{ database | tojson }};


        var elementCounty = document.getElementById("county");
        var selectedCounty = elementCounty.options[elementCounty.selectedIndex].value;

        // if a county has not been selected and is still on
        // the "Choose a county" selection
        if ((selectedCounty.localeCompare("noSelection")==0))
        {
            // No county selected
        } else 
        {
            // for each daycare in the database
            for (i = 0; i < database.length; i++)
            {
                //check to see if the daycare even has a county
                if ('county' in database[i])
                {
                    //compare each daycare in the databases county to
                    // the selected county
                    if ((selectedCounty.localeCompare(database[i].county)==0))
                    {
                        // if they have the same county, add the .index
                        // of that daycare to the filtered daycare array
                        filteredDaycareArray.push(database[i].index);
                    }
                }
                    
            }

        }


        var elementType = document.getElementById("daycare_type");
        var selectedType = elementType.options[elementType.selectedIndex].value;

        // check to see that the type of facility has been selected
        if ((selectedType.localeCompare("noSelection")==0))
        {
            // No type selected
        } else
        {   // go through all of the FILTERED daycares indexs
            for (i = 0; i < filteredDaycareArray.length ; i++)
            {
                // make sure family_home is even in that daycare
                if ('family_home' in database[filteredDaycareArray[i]])
                {
                    // this is confusing, but it's just comparing like before
                    if (selectedType.localeCompare("DayCare")==0)
                    {
                        var yes = "Yes";
                        if(yes.localeCompare(database[filteredDaycareArray[i]].family_home)==0)
                        {
                            // this selected daycare does not line up with the filtering,
                            // so add it to the list of daycares to be deleted
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    } else
                    {
                        var no = "No";
                        if(no.localeCompare(database[filteredDaycareArray[i]].family_home)==0)
                        {
                            // same here as above
                            daycaresToDelete.push(filteredDaycareArray[i]);
                        }
                    }
                }
            }
        }

        // now, update the filteredArray so that it deletes all
        // entrys that are in the daycaresToDelete array
        filteredDaycareArray = updateDaycares();
        
        var elementAnalInspection = document.getElementById("annualInspection");
        if (elementAnalInspection.checked)
        {
            for (i = 0; i < filteredDaycareArray.length ; i++)
            {
                if('annual_inspection' in database[filteredDaycareArray[i]])
                {
                    // do nothing
                }
                else
                {
                    daycaresToDelete.push(filteredDaycareArray[i]);
                }
            }
        }
        else
        {
            for (i = 0; i < filteredDaycareArray.length ; i++)
            {
                if('annual_inspection' in database[filteredDaycareArray[i]])
                {
                    daycaresToDelete.push(filteredDaycareArray[i]);
                }
            }
        }

        filteredDaycareArray = updateDaycares();

        var elementUnaInspection = document.getElementById("unannouncedInspection");
        if (elementAnalInspection.checked)
        {
            for (i = 0; i < filteredDaycareArray.length ; i++)
            {
                if('annual_inspection' in database[filteredDaycareArray[i]])
                {
                    // do nothing
                }
                else
                {
                    daycaresToDelete.push(filteredDaycareArray[i]);
                }
            }
        }
        else
        {
            for (i = 0; i < filteredDaycareArray.length ; i++)
            {
                if('annual_inspection' in database[filteredDaycareArray[i]])
                {
                    daycaresToDelete.push(filteredDaycareArray[i]);
                }
            }
        }









        
        //document.getElementById("testing").innerHTML = currentDaycares;
        var object = document.getElementById("county");
        var value = object.options[object.selectedIndex].value;
        document.getElementById("testing").innerHTML = filteredDaycareArray;
        document.getElementById("testing2").innerHTML = daycaresToDelete;
        document.getElementById("testing3").innerHTML = uncommonValues;
        showDaycares();
        //window.alert(database);
        //window.alert(daycare["age_range"]);
        //if(daycare["age_range"] = "5 years - 12 years"){
        //    window.alert("One found");
        //}
        
        
    }
        
    
    function testing(){
        window.alert("Looks like it worked");
    }
    </script>

{% endblock content %}