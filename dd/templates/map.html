{% extends 'layout.html' %}

{% block head %}

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename = 'map.css') }}">

{% endblock head %}

{% block content %}

    <div class = "map-container flexh">
        <div id = "map" class="map"></div>
        <div class="filter"></div>
    </div>

    <script type="text/javascript">
        navigator.geolocation.getCurrentPosition(setPosition);

        function setPosition(position)
        {
            var map = L.map('map').setView([position.coords.latitude, position.coords.longitude], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map)

            const database = {{ database | tojson }};

            for (i = 0; i < database.length; i++)
            {
                if ('location' in database[i])
                {
                    var link = '<a href="/daycare/'+i+'">Click here for more info.</a>'
                    L.marker([database[i].location.latitude, database[i].location.longitude]).addTo(map)
                    .bindPopup("<b>"+database[i].facility_name+"</b><br>"+link);
                }
            }
        }
    </script>

{% endblock content %}